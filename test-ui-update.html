<!DOCTYPE html>
<html>
<head>
    <title>Test UI Update Issue</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { border: 2px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .game { padding: 10px; margin: 5px 0; background: #f5f5f5; border-radius: 5px; }
        .florida { background: #ffe0e0; border: 2px solid red; }
    </style>
</head>
<body>
    <h1>Debug UI Update Issue - Florida Game</h1>
    
    <div class="section">
        <h2>1. Database Check</h2>
        <button onclick="checkDatabase()">Check Firebase Database</button>
        <div id="dbStatus"></div>
    </div>
    
    <div class="section">
        <h2>2. UI Check</h2>
        <button onclick="checkUI()">Check What UI Shows</button>
        <div id="uiStatus"></div>
    </div>
    
    <div class="section">
        <h2>3. Cache Check</h2>
        <button onclick="checkCache()">Check Local Storage & Cache</button>
        <div id="cacheStatus"></div>
    </div>
    
    <div class="section">
        <h2>4. Fix Actions</h2>
        <button onclick="clearEverything()">Clear All Caches</button>
        <button onclick="fixDatabase()">Fix Database Directly</button>
        <button onclick="forceSyncNow()">Force Sync Now</button>
        <div id="fixStatus"></div>
    </div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyBJascYs4rXD4uL5Z8F7RDkMOBhQtjehic",
            authDomain: "texas-tailgaters.firebaseapp.com",
            databaseURL: "https://texas-tailgaters-default-rtdb.firebaseio.com",
            projectId: "texas-tailgaters",
            storageBucket: "texas-tailgaters.appspot.com",
            messagingSenderId: "517392756353",
            appId: "1:517392756353:web:texas-tailgaters-web"
        };
        
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        window.checkDatabase = async function() {
            const statusDiv = document.getElementById('dbStatus');
            statusDiv.innerHTML = '<p>Checking database...</p>';
            
            try {
                const gamesRef = ref(database, 'games');
                const snapshot = await get(gamesRef);
                
                if (snapshot.exists()) {
                    const games = snapshot.val();
                    let floridaGame = null;
                    let floridaId = null;
                    
                    Object.entries(games).forEach(([id, game]) => {
                        if (game.opponent === 'Florida') {
                            floridaGame = game;
                            floridaId = id;
                            window.floridaGameId = id;
                        }
                    });
                    
                    if (floridaGame) {
                        const isCorrect = floridaGame.date === '2025-10-04';
                        statusDiv.innerHTML = `
                            <div class="${isCorrect ? 'success' : 'error'}">
                                Database has Florida game on: ${floridaGame.date}
                                ${isCorrect ? '✓ CORRECT' : '❌ WRONG - Should be 2025-10-04'}
                            </div>
                            <div>Game ID: ${floridaId}</div>
                            <div>Time: ${floridaGame.time || 'TBD'}</div>
                            <div>Location: ${floridaGame.location}</div>
                        `;
                    } else {
                        statusDiv.innerHTML = '<p class="error">Florida game not found!</p>';
                    }
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        };
        
        window.checkUI = function() {
            const statusDiv = document.getElementById('uiStatus');
            statusDiv.innerHTML = `
                <p>Opening production site in new window...</p>
                <p>Check what date shows for Florida game</p>
                <iframe src="https://texas-tailgaters.onrender.com/games" width="100%" height="400"></iframe>
            `;
        };
        
        window.checkCache = function() {
            const statusDiv = document.getElementById('cacheStatus');
            let html = '<h3>Local Storage:</h3>';
            
            // Check localStorage
            const lastSync = localStorage.getItem('lastScheduleSync');
            html += `<p>Last Sync: ${lastSync || 'Never'}</p>`;
            
            // Check all localStorage keys
            html += '<p>All localStorage keys:</p><ul>';
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                html += `<li>${key}: ${localStorage.getItem(key)}</li>`;
            }
            html += '</ul>';
            
            statusDiv.innerHTML = html;
        };
        
        window.clearEverything = function() {
            const statusDiv = document.getElementById('fixStatus');
            
            // Clear localStorage
            localStorage.clear();
            
            // Clear sessionStorage
            sessionStorage.clear();
            
            statusDiv.innerHTML = '<p class="success">✓ All caches cleared!</p>';
            statusDiv.innerHTML += '<p>Now reload the app to trigger fresh sync</p>';
        };
        
        window.fixDatabase = async function() {
            if (!window.floridaGameId) {
                alert('Run database check first!');
                return;
            }
            
            const statusDiv = document.getElementById('fixStatus');
            statusDiv.innerHTML = '<p>Fixing database...</p>';
            
            try {
                const gameRef = ref(database, `games/${window.floridaGameId}`);
                
                // Get current data first
                const snapshot = await get(gameRef);
                const currentData = snapshot.val();
                
                // Update with correct date
                await update(gameRef, {
                    ...currentData,
                    date: '2025-10-04',
                    updated_at: new Date().toISOString()
                });
                
                statusDiv.innerHTML = '<p class="success">✓ Database updated to Oct 4!</p>';
                
                // Verify the update
                const verifySnapshot = await get(gameRef);
                const verifyData = verifySnapshot.val();
                statusDiv.innerHTML += `<p>Verified: Date is now ${verifyData.date}</p>`;
                
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        };
        
        window.forceSyncNow = function() {
            const statusDiv = document.getElementById('fixStatus');
            
            // Clear sync date
            localStorage.removeItem('lastScheduleSync');
            
            statusDiv.innerHTML = `
                <p class="success">✓ Sync cache cleared</p>
                <p>Opening app in new window to trigger sync...</p>
            `;
            
            // Open both local and production
            window.open('http://localhost:5173/games', '_blank');
            setTimeout(() => {
                window.open('https://texas-tailgaters.onrender.com/games', '_blank');
            }, 2000);
        };
        
        // Check everything on load
        checkDatabase();
        checkCache();
    </script>
</body>
</html>
