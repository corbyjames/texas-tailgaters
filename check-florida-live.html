<!DOCTYPE html>
<html>
<head>
    <title>Check Florida Game in Live Database</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .game { padding: 10px; margin: 5px 0; background: #f5f5f5; border-radius: 5px; }
        .florida { background: #ffe0e0; font-weight: bold; border: 2px solid red; }
        .correct { background: #e0ffe0; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Live Database Check - Florida Game Date</h1>
    
    <button onclick="checkDatabase()">Check Current Database</button>
    <button onclick="forceSync()">Force Sync Update</button>
    <button onclick="manualFix()">Manually Fix Florida Date</button>
    
    <div id="status"></div>
    <div id="games"></div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get, set, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyBJascYs4rXD4uL5Z8F7RDkMOBhQtjehic",
            authDomain: "texas-tailgaters.firebaseapp.com",
            databaseURL: "https://texas-tailgaters-default-rtdb.firebaseio.com",
            projectId: "texas-tailgaters",
            storageBucket: "texas-tailgaters.appspot.com",
            messagingSenderId: "517392756353",
            appId: "1:517392756353:web:texas-tailgaters-web"
        };
        
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        window.checkDatabase = async function() {
            const statusDiv = document.getElementById('status');
            const gamesDiv = document.getElementById('games');
            
            statusDiv.innerHTML = '<p>Checking Firebase database...</p>';
            
            try {
                const gamesRef = ref(database, 'games');
                const snapshot = await get(gamesRef);
                
                if (snapshot.exists()) {
                    const games = snapshot.val();
                    let floridaGame = null;
                    let floridaId = null;
                    
                    // Find Florida game
                    Object.entries(games).forEach(([id, game]) => {
                        if (game.opponent === 'Florida') {
                            floridaGame = game;
                            floridaId = id;
                        }
                    });
                    
                    if (floridaGame) {
                        const currentDate = floridaGame.date;
                        const correctDate = '2025-10-04';
                        const isCorrect = currentDate === correctDate;
                        
                        const gameDate = new Date(currentDate + 'T12:00:00-05:00');
                        const dayOfWeek = gameDate.toLocaleDateString('en-US', { weekday: 'long' });
                        
                        let statusHtml = '';
                        if (isCorrect) {
                            statusHtml = '<p class="success">✓ Florida game date is CORRECT: October 4, 2025 (Saturday)</p>';
                        } else {
                            statusHtml = `
                                <p class="error">❌ Florida game date is INCORRECT!</p>
                                <p>Current: ${currentDate} (${dayOfWeek})</p>
                                <p>Should be: ${correctDate} (Saturday)</p>
                                <p>Game ID: ${floridaId}</p>
                            `;
                            
                            // Store the ID for manual fix
                            window.floridaGameId = floridaId;
                        }
                        
                        statusDiv.innerHTML = statusHtml;
                        
                        // Show all October games for context
                        let html = '<h3>All October 2025 Games:</h3>';
                        Object.entries(games).forEach(([id, game]) => {
                            if (game.date && game.date.startsWith('2025-10')) {
                                const date = new Date(game.date + 'T12:00:00-05:00');
                                const day = date.toLocaleDateString('en-US', { weekday: 'long' });
                                const isFloridaGame = game.opponent === 'Florida';
                                const isCorrectDate = game.date === '2025-10-04' && isFloridaGame;
                                
                                html += `
                                    <div class="game ${isFloridaGame ? 'florida' : ''} ${isCorrectDate ? 'correct' : ''}">
                                        <strong>${game.date} (${day})</strong> - 
                                        ${game.is_home ? 'vs' : '@'} ${game.opponent}
                                        ${game.time || 'TBD'} - ${game.tv_network || 'TBD'}
                                        ${isFloridaGame ? ' ← FLORIDA GAME' : ''}
                                    </div>
                                `;
                            }
                        });
                        
                        gamesDiv.innerHTML = html;
                    } else {
                        statusDiv.innerHTML = '<p class="error">❌ Florida game not found in database!</p>';
                        gamesDiv.innerHTML = '';
                    }
                } else {
                    statusDiv.innerHTML = '<p class="error">No games in database!</p>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        };
        
        window.forceSync = function() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<p>Opening app to trigger sync...</p>';
            
            // Clear localStorage to force sync
            localStorage.removeItem('lastScheduleSync');
            
            // Open the production site
            window.open('https://texas-tailgaters.onrender.com/games', '_blank');
            
            statusDiv.innerHTML += '<p>Sync triggered. Wait a few seconds then check database again.</p>';
        };
        
        window.manualFix = async function() {
            if (!window.floridaGameId) {
                alert('Florida game ID not found. Check database first.');
                return;
            }
            
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<p>Manually fixing Florida game date...</p>';
            
            try {
                const gameRef = ref(database, `games/${window.floridaGameId}`);
                await update(gameRef, {
                    date: '2025-10-04',
                    updated_at: new Date().toISOString()
                });
                
                statusDiv.innerHTML = '<p class="success">✓ Florida game date manually updated to October 4, 2025!</p>';
                
                // Refresh the display
                setTimeout(() => checkDatabase(), 1000);
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">Error updating: ${error.message}</p>`;
            }
        };
        
        // Check on load
        checkDatabase();
    </script>
</body>
</html>
